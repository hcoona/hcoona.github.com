<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="CE2QArf5fjsQPPRbfXjtRJhVX-T6HZ1lVgKfTFby_3A">
  <meta name="baidu-site-verification" content="code-MbGHohQ17H">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hcoona.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/config.js" defer=""></script>

    <meta name="description" content="本文介绍了什么是尾递归，什么是CPS，以及如何应用前两者将递归转化为循环。">
<meta property="og:type" content="article">
<meta property="og:title" content="尾递归、CPS和将递归转化为循环的一般方法">
<meta property="og:url" content="https://hcoona.github.io/Functional-Programming/tail-recursion-cps-and-recursion-to-loop/index.html">
<meta property="og:site_name" content="HCOONa's blog">
<meta property="og:description" content="本文介绍了什么是尾递归，什么是CPS，以及如何应用前两者将递归转化为循环。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2013-07-17T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-28T05:15:47.298Z">
<meta property="article:author" content="Shuai Zhang">
<meta property="article:tag" content="Functional Programming">
<meta property="article:tag" content="Algorithms">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://hcoona.github.io/Functional-Programming/tail-recursion-cps-and-recursion-to-loop/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hcoona.github.io/Functional-Programming/tail-recursion-cps-and-recursion-to-loop/","path":"Functional-Programming/tail-recursion-cps-and-recursion-to-loop/","title":"尾递归、CPS和将递归转化为循环的一般方法"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>尾递归、CPS和将递归转化为循环的一般方法 | HCOONa's blog</title>
  
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FC1VDVXMFD"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-FC1VDVXMFD","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/third-party/analytics/google-analytics.js" defer=""></script>




  <script>
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "lk3wjeo70z");
</script>




  
  <script src="https://unpkg.com/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer=""></script>
  <script src="https://unpkg.com/@next-theme/pjax@0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer=""></script>
  <script src="https://unpkg.com/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer=""></script>
  <script src="https://unpkg.com/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer=""></script>
  <script src="https://unpkg.com/pangu@7.2.0/dist/browser/pangu.umd.js" integrity="sha256-JnmRRnJK7DC6RQJbAJb6AXOM9OmWzS6z8eYultk/48Y=" crossorigin="anonymous" defer=""></script>
<script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/utils.js" defer=""></script><script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/motion.js" defer=""></script><script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/sidebar.js" defer=""></script><script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/next-boot.js" defer=""></script><script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/pjax.js" defer=""></script>

  
  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://unpkg.com/pdfobject@2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/third-party/tags/pdf.js" defer=""></script>



  <script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/third-party/fancybox.js" defer=""></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://unpkg.com/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/third-party/math/mathjax.js" defer=""></script>


  <script src="https://unpkg.com/quicklink@3.0.1/dist/quicklink.umd.js" integrity="sha256-44BednzIpUeQJcY8qtLyarFu0UCCTbgmWOvaoehiFQQ=" crossorigin="anonymous" defer=""></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://hcoona.github.io/Functional-Programming/tail-recursion-cps-and-recursion-to-loop/"}</script>
  <script src="https://unpkg.com/hexo-theme-next@8.24.1/source/js/third-party/quicklink.js" defer=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="HCOONa's blog" type="application/atom+xml">
<link rel="alternate" href="/rss.xml" title="HCOONa's blog" type="application/rss+xml">
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">HCOONa's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#_%E5%B0%BE%E9%80%92%E5%BD%92_tail_recursion"><span class="nav-number">1.</span> <span class="nav-text">尾递归 (Tail Recursion)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#_continuation_passing_style_cps"><span class="nav-number">2.</span> <span class="nav-text">Continuation Passing Style (CPS)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#_%E9%80%92%E5%BD%92%E8%BD%AC%E4%B8%BA%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.</span> <span class="nav-text">递归转为循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#_c%E4%B8%AD%E7%9A%84%E5%B0%9D%E8%AF%95"><span class="nav-number">3.1.</span> <span class="nav-text">C++中的尝试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#_c%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.2.</span> <span class="nav-text">C语言实现</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Shuai Zhang" src="//www.gravatar.com/avatar/80d20dde8a29396d8ec78af0289a3e88">
  <p class="site-author-name" itemprop="name">Shuai Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/hcoona/" title="GitHub → https://github.com/hcoona/" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/zhangshuai89" title="ZhiHu → https://www.zhihu.com/people/zhangshuai89" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>ZhiHu</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://unpkg.com/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_nd.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN" data-clarity-region="article">
    <link itemprop="mainEntityOfPage" href="https://hcoona.github.io/Functional-Programming/tail-recursion-cps-and-recursion-to-loop/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//www.gravatar.com/avatar/80d20dde8a29396d8ec78af0289a3e88">
      <meta itemprop="name" content="Shuai Zhang">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HCOONa's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="尾递归、CPS和将递归转化为循环的一般方法 | HCOONa's blog">
      <meta itemprop="description" content="本文介绍了什么是尾递归，什么是CPS，以及如何应用前两者将递归转化为循环。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          尾递归、CPS和将递归转化为循环的一般方法
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2013-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2013-07-18T00:00:00+08:00">2013-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-08-28 13:15:47" itemprop="dateModified" datetime="2025-08-28T13:15:47+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Functional-Programming/" itemprop="url" rel="index"><span itemprop="name">Functional Programming</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">本文介绍了什么是尾递归，什么是CPS，以及如何应用前两者将递归转化为循环。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><div class="paragraph">
<p>本文介绍了什么是尾递归，什么是CPS，以及如何应用前两者将递归转化为循环。</p>
</div>
<div class="sect1">
<h2 id="_尾递归_tail_recursion">尾递归 (Tail Recursion)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/">Wikipedia</a> 中是这样定义尾递归的：</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>尾部递归是一种编程技巧。递归函数是指一些会在函数内调用自己的函数，如果在递归函数中，递归调用返回的结果总被直接返回，则称为尾部递归。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>尾递归相对于普通的递归有一个_好处_ <a href="#tail-recursion-optimization">[tail-recursion-optimization]</a>：由于在递归调用结束后没有任何其他的操作，直接将递归调用的结果作为当前调用的结果返回，因此不需要保存当前调用栈帧，在递归调用的时候，可以直接修改当前栈帧上的变量。</p>
</div>
<div class="paragraph">
<p>总的来说，尾递归可以被认为等价于循环。</p>
</div>
<div class="paragraph">
<p>我们来看一个例子：阶乘函数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="function"><span class="type">int</span> <span class="title">factorial</span><span class="params">(<span class="type">int</span> n)</span> </span>{
    <span class="built_in">assert</span> (n &gt;= <span class="number">0</span>);
    <span class="keyword">if</span> (n == <span class="number">0</span>) {
        <span class="keyword">return</span> <span class="number">1</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> n * <span class="built_in">factorial</span>(n - <span class="number">1</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个函数不是尾递归的，因为它在调用完自己后，还要进行一些操作，比如说乘\(n\)。但是我们可以轻易的将其改写为尾递归的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">factorial_recursive_aux</span><span class="params">(<span class="type">int</span> acc, <span class="type">int</span> n)</span> </span>{
    <span class="keyword">if</span> (n) {
        <span class="keyword">return</span> <span class="built_in">factorial_recursive_aux</span>(acc * n, n - <span class="number">1</span>);
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> acc;
    }
}

<span class="function"><span class="type">int</span> <span class="title">factorial_recursive</span><span class="params">(<span class="type">int</span> n)</span> </span>{
    <span class="built_in">assert</span> (n &gt;= <span class="number">0</span>);
    <span class="keyword">return</span> <span class="built_in">factorial_recursive_aux</span>(<span class="number">1</span>, n);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过引入一个参数`acc`，我们可以将原本在递归调用之后才进行的计算提前到递归调用时，从而将一个普通的递归调用转化为尾递归调用。根据上面提到的_优化原则_ <a href="#tail-recursion-optimization">[tail-recursion-optimization]</a>，我们还可以这样优化这一尾递归调用函数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">factorial_recursive_opt</span><span class="params">(<span class="type">int</span> acc, <span class="type">int</span> n)</span> </span>{
FRO_START:
    <span class="keyword">if</span> (n) {
        acc *= n;
        n--;
        <span class="keyword">goto</span> FRO_START;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> acc;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>容易发现，这样一个函数等价于这样一个循环：</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="type">int</span> acc = <span class="number">1</span>;
<span class="keyword">for</span> (; n; n--) {
    acc *= n;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，虽然这里用一个`while (n--)`更为简洁，但是我还是特别写了一个`for`循环以跟上面的代码一一对应。这是因为，在有些情况下，判断和更改变量的步骤更为复杂，此时用一个`while`循环就比较困难了。</p>
</div>
<div class="paragraph">
<p>可惜将一个递归调用转换为尾递归调用并不总是这么容易。比如下面这个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="function"><span class="type">int</span> <span class="title">fibonacci</span><span class="params">(<span class="type">int</span> n)</span> </span>{
    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) {
        <span class="keyword">return</span> <span class="number">0</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) {
        <span class="keyword">return</span> <span class="number">1</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="built_in">fibonacci</span>(n - <span class="number">1</span>) + <span class="built_in">fibonacci</span>(n - <span class="number">2</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>再比如更加复杂的归并排序，快速排序。</p>
</div>
<div class="paragraph">
<p>因为下面的内容用函数式语言叙述更加方便，所以在此先给出Fibonacci函数对应的用FSharp语言写的代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight fsharp"><span class="keyword">let</span> <span class="keyword">rec</span> fibonacci n <span class="operator">=</span>
    <span class="keyword">match</span> n <span class="keyword">with</span>
    <span class="operator">|</span> _ <span class="keyword">when</span> n <span class="operator">&lt;=</span> <span class="number">0</span> <span class="operator">-&gt;</span> <span class="number">0</span>
    <span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> <span class="number">2</span> <span class="operator">-&gt;</span> <span class="number">1</span>
    <span class="operator">|</span> _ <span class="operator">-&gt;</span> (fibonacci (n <span class="operator">-</span> <span class="number">1</span>)) <span class="operator">+</span> (fibonacci (n <span class="operator">-</span> <span class="number">2</span>))
;;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_continuation_passing_style_cps">Continuation Passing Style (CPS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/">Wikipedia</a> 中是这样定义CPS的：</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In functional programming, continuation-passing style (CPS) is a style of programming in which control is passed explicitly in the form of a continuation.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>理论总是那么抽象，我们不妨来看一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight fsharp"><span class="keyword">let</span> <span class="keyword">rec</span> factorial n <span class="operator">=</span>
    <span class="keyword">match</span> n <span class="keyword">with</span>
    <span class="operator">|</span> _ <span class="keyword">when</span> n <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">-&gt;</span> <span class="built_in">failwith</span> <span class="string">"n must not be less than 0."</span>
    <span class="operator">|</span> <span class="number">0</span> <span class="operator">-&gt;</span> <span class="number">1</span>
    <span class="operator">|</span> _ <span class="operator">-&gt;</span> n <span class="operator">*</span> (factorial (n <span class="operator">-</span> <span class="number">1</span>))
;;

<span class="keyword">let</span> factorial_cps n <span class="operator">=</span>
    <span class="keyword">let</span> <span class="keyword">rec</span> factorial_aux n cont <span class="operator">=</span>
        <span class="keyword">match</span> n <span class="keyword">with</span>
        <span class="operator">|</span> <span class="number">0</span> <span class="operator">-&gt;</span> cont <span class="number">1</span>
        <span class="operator">|</span> _ <span class="operator">-&gt;</span> factorial_aux (n <span class="operator">-</span> <span class="number">1</span>) (<span class="keyword">fun</span> acc <span class="operator">-&gt;</span> cont (acc <span class="operator">*</span> n))
    <span class="keyword">in</span>
    <span class="keyword">if</span> n <span class="operator">&lt;</span> <span class="number">0</span> <span class="keyword">then</span> <span class="built_in">failwith</span> <span class="string">"n must not be less than 0."</span>
    <span class="keyword">else</span> factorial_aux n (<span class="keyword">fun</span> x <span class="operator">-&gt;</span> x)
;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到，我们将原本会发生在递归调用之后进行的操作——乘`n`，通过Continuation的方式，保留到之后的某一时刻再进行调用（具体于这个例子而言，是在`n = 0`时）。并且在每次递归调用的时候，都将Continuation作为参数之一进行传递。这就是Continuation-passing style。</p>
</div>
<div class="paragraph">
<p>CPS的好处就是，能够将原本不是尾递归的普通递归调用转化为尾递归形式。至此，如何将一般递归转化为循环的方法，就比较明朗了。</p>
</div>
<div class="paragraph">
<p>接下来，我们来看一个比较复杂的_例子_ <a href="#lambda">[lambda]</a>：Fibonacci。（这里不考虑使用 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Dynamic_Programming">动态规划 (Dynamic Programming)</a> 对其进行优化的情况）</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight fsharp"><span class="keyword">let</span> fibonacci_cps n <span class="operator">=</span>
    <span class="keyword">let</span> <span class="keyword">rec</span> fibonacci_aux n cont <span class="operator">=</span>
        <span class="keyword">match</span> n <span class="keyword">with</span>
        <span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> <span class="number">2</span> <span class="operator">-&gt;</span> cont <span class="number">1</span>
        <span class="operator">|</span> _ <span class="operator">-&gt;</span> fibonacci_aux
                    (n <span class="operator">-</span> <span class="number">1</span>)
                    (<span class="keyword">fun</span> acc1 <span class="operator">-&gt;</span> fibonacci_aux
                                    (n <span class="operator">-</span> <span class="number">2</span>)
                                    (<span class="keyword">fun</span> acc2 <span class="operator">-&gt;</span> cont (acc1 <span class="operator">+</span> acc2)))
    <span class="keyword">in</span>
    <span class="keyword">match</span> n <span class="keyword">with</span>
    <span class="operator">|</span> _ <span class="keyword">when</span> n <span class="operator">&lt;=</span> <span class="number">0</span> <span class="operator">-&gt;</span> <span class="number">0</span>
    <span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span> <span class="number">2</span> <span class="operator">-&gt;</span> <span class="number">1</span>
    <span class="operator">|</span> _ <span class="operator">-&gt;</span> fibonacci_aux n (<span class="keyword">fun</span> x <span class="operator">-&gt;</span> x)
;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>回顾一下我们之前写的`fibonacci`函数，我们容易发现，唯一的不同之处就在于，我们使用`fibonacci_aux`函数来完成以前`fibonacci`函数的主要功能（递归）。而`fibonacci_aux`函数与原来的`fibonacci`函数的不同之处，除了没有处理`n ⇐ 0`的情况以外，主要在于使用匿名函数将完成当前语句之后要做的事情作为参数进行传递。这样一来，通过将递归调用之后所做的操作通过参数进行传递，在执行完了所有的递归步骤之后，再进行计算，使得我们将一个复杂的普通递归调用转换成为了尾递归调用。</p>
</div>
<div class="paragraph">
<p>对于这点不明白的听众，不妨手工展开`n = 4`的情况。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>以下将fibonacci_aux简写为f
   f 4 (fun x -&gt; x)
=&gt; f 3 (fun x -&gt; f 2 (fun y -&gt; (fun xx -&gt; xx) (x + y)))
=&gt; f 3 (fun x -&gt; f 2 (fun y -&gt; x + y))
=&gt; f 3 (fun x -&gt; (fun y -&gt; x + y) 1)
=&gt; f 3 (fun x -&gt; x + 1)
=&gt; f 2 (fun x -&gt; f 1 (fun y -&gt; (fun xx -&gt; xx + 1) (x + y)))
=&gt; f 2 (fun x -&gt; (fun y -&gt; (fun xx -&gt; xx + 1) (x + y)) 1)
=&gt; f 2 (fun x -&gt; (fun xx -&gt; xx + 1) (x + 1))
=&gt; (fun x -&gt; (fun xx -&gt; xx + 1) (x + 1)) 1
=&gt; (fun xx -&gt; xx + 1) 2
=&gt; 3</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_递归转为循环">递归转为循环</h2>
<div class="sectionbody">
<div class="paragraph">
<p>到这里，我们至少知道了在函数式编程语言中，如何将一个一般递归调用转换为尾递归调用。下面，我们讨论在C++和C语言中，应该怎么做。</p>
</div>
<div class="sect2">
<h3 id="_c中的尝试">C++中的尝试</h3>
<div class="paragraph">
<p>对于C++11而言，由于引入了_Lambda_ <a href="#CXX11-lambda">[CXX11-lambda]</a>，使得理论上做这件事的难度和函数式编程语言差不多。</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _FContTy&gt;</span>
<span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">fibonacci_aux</span><span class="params">(<span class="type">int</span> n, _FContTy cont)</span></span>
<span class="function"></span>{
    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) {
        <span class="keyword">return</span> <span class="built_in">cont</span>(<span class="number">1</span>);
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="built_in">fibonacci_aux</span>(n - <span class="number">1</span>, [=](<span class="type">int</span> acc1) {
            <span class="keyword">return</span> <span class="built_in">fibonacci_aux</span>(n - <span class="number">2</span>, [=](<span class="type">int</span> acc2) {
                <span class="keyword">return</span> <span class="built_in">cont</span>(acc1 + acc2);
            });
        });
    }
}

<span class="function"><span class="type">int</span> <span class="title">fibonacci</span><span class="params">(<span class="type">int</span> n)</span></span>
<span class="function"></span>{
    <span class="keyword">return</span> <span class="built_in">fibonacci_aux</span>(n, [](<span class="type">int</span> x) { <span class="keyword">return</span> x; });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是实际上，这段代码无论是使用_最新版本的Visual
Studio_ <a href="#latest-vs">[latest-vs]</a>或者是_最新版本的G++_ <a href="#latest-gxx">[latest-gxx]</a>都无法编译（表现为长时间无响应，占用内存疯狂增长）。但是这并不是编译器的Bug，而是因为这段递归程序在编译时期转换成仿函数(Functor)时会产生一个无穷递归，感兴趣的听众手工模拟一下编译器的工作就能发现这一点。况且实际上最好的情况下，也会有两个fibonacci_aux函数产生（因为有两个不同的lambda作为参数cont），使得生成的代码实际上不是尾递归调用（而是间接尾递归调用）。</p>
</div>
<div class="paragraph">
<p>编译器不够聪明，没办法处理好这件事，不过我们可以手工来处理这种情况。使用继承和多态的特性，我们可以统一`cont`的类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span>

<span class="keyword">using</span> <span class="keyword">namespace</span> std;

<span class="keyword">class</span> <span class="title class_">ContF</span> {
<span class="keyword">protected</span>:
    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">Imp</span><span class="params">(<span class="type">int</span> x)</span> <span class="type">const</span> </span>= <span class="number">0</span>;
<span class="keyword">public</span>:
    <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> x)</span> <span class="type">const</span> </span>{ <span class="keyword">return</span> <span class="built_in">Imp</span>(x); }
};

<span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, shared_ptr&lt;ContF&gt; cont)</span></span>;

<span class="keyword">class</span> <span class="title class_">ContIdentityF</span> : <span class="keyword">public</span> ContF {
<span class="keyword">protected</span>:
    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">Imp</span><span class="params">(<span class="type">int</span> x)</span> <span class="type">const</span> <span class="keyword">override</span> </span>{ <span class="keyword">return</span> x; }
};

<span class="keyword">class</span> <span class="title class_">ContInnerF</span> : <span class="keyword">public</span> ContF {
<span class="keyword">private</span>:
    <span class="type">int</span> x;
    shared_ptr&lt;ContF&gt; cont;
<span class="keyword">protected</span>:
    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">Imp</span><span class="params">(<span class="type">int</span> y)</span> <span class="type">const</span> <span class="keyword">override</span> </span>{
        <span class="keyword">return</span> cont-&gt;<span class="built_in">operator</span>() (x + y);
    }
<span class="keyword">public</span>:
    <span class="built_in">ContInnerF</span>(<span class="type">int</span> x, shared_ptr&lt;ContF&gt; cont) : <span class="built_in">x</span>(x), <span class="built_in">cont</span>(cont) { }
};

<span class="keyword">class</span> <span class="title class_">ContOuterF</span> : <span class="keyword">public</span> ContF {
<span class="keyword">private</span>:
    <span class="type">int</span> n;
    shared_ptr&lt;ContF&gt; cont;
<span class="keyword">protected</span>:
    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">Imp</span><span class="params">(<span class="type">int</span> x)</span> <span class="type">const</span> <span class="keyword">override</span> </span>{
        <span class="keyword">return</span> <span class="built_in">f</span>(n - <span class="number">2</span>, <span class="built_in">make_shared</span>&lt;ContInnerF&gt;(x, cont));
    }
<span class="keyword">public</span>:
    <span class="built_in">ContOuterF</span>(<span class="type">int</span> n, shared_ptr&lt;ContF&gt; cont) : <span class="built_in">n</span>(n), <span class="built_in">cont</span>(cont) { }
};

<span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, shared_ptr&lt;ContF&gt; cont)</span> </span>{
    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) {
        <span class="keyword">return</span> cont-&gt;<span class="built_in">operator</span>() (<span class="number">1</span>);
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="built_in">f</span>(n - <span class="number">1</span>, <span class="built_in">make_shared</span>&lt;ContOuterF&gt;(n, cont));
    }
}

<span class="function"><span class="type">int</span> <span class="title">fibonacci</span><span class="params">(<span class="type">int</span> n)</span> </span>{
    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) {
        <span class="keyword">return</span> <span class="number">0</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="built_in">f</span>(n, <span class="built_in">make_shared</span>&lt;ContIdentityF&gt;());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是即便是这样，由于我们在仿函数中调用了函数`f`，编译器仍然不会“智能的”帮我们优化这一间接尾递归调用。因此我们还需要更进一步的调整，将仿函数中的函数和数据分开，为进一步整合函数创造条件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span>

<span class="keyword">using</span> <span class="keyword">namespace</span> std;

<span class="keyword">enum class</span> <span class="title class_">ContDataType</span> { Identity, Outer, Inner };

<span class="keyword">struct</span> <span class="title class_">ContData</span> {
    <span class="type">const</span> ContDataType type;
    <span class="type">const</span> <span class="type">int</span> x;
    <span class="type">const</span> shared_ptr&lt;ContData&gt; p;

    <span class="built_in">ContData</span>(ContDataType type, <span class="type">int</span> x, shared_ptr&lt;ContData&gt; p)
        : <span class="built_in">type</span>(type), <span class="built_in">x</span>(x), <span class="built_in">p</span>(p)
    {
        _ASSERT(type == ContDataType::Outer
             || type == ContDataType::Inner);
    }
    <span class="built_in">ContData</span>()
        : <span class="built_in">type</span>(ContDataType::Identity), <span class="built_in">x</span>(<span class="number">0</span>), <span class="built_in">p</span>(<span class="literal">nullptr</span>)
    { }
};

<span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, shared_ptr&lt;ContData&gt; data)</span></span>;

<span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">f_cont</span><span class="params">(<span class="type">int</span> x, shared_ptr&lt;ContData&gt; data)</span> </span>{
    <span class="keyword">switch</span> (data-&gt;type)
    {
    <span class="keyword">case</span> ContDataType::Identity:
        <span class="keyword">return</span> x;
    <span class="keyword">case</span> ContDataType::Outer:
        <span class="keyword">return</span> <span class="built_in">f</span>(
            data-&gt;x - <span class="number">2</span>,
            <span class="built_in">make_shared</span>&lt;ContData&gt;(ContDataType::Inner, x, data-&gt;p));
    <span class="keyword">case</span> ContDataType::Inner:
        <span class="keyword">return</span> <span class="built_in">f_cont</span>(data-&gt;x + x, data-&gt;p);
    }
}

<span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, shared_ptr&lt;ContData&gt; cont)</span> </span>{
    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) {
        <span class="keyword">return</span> <span class="built_in">f_cont</span>(<span class="number">1</span>, cont);
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="built_in">f</span>(
            n - <span class="number">1</span>,
            <span class="built_in">make_shared</span>&lt;ContData&gt;(ContDataType::Outer, n, cont));
    }
}

<span class="function"><span class="type">int</span> <span class="title">fib</span><span class="params">(<span class="type">int</span> n)</span> </span>{
    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) {
        <span class="keyword">return</span> <span class="number">0</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="built_in">f</span>(n, <span class="built_in">make_shared</span>&lt;ContData&gt;());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>接下来，我们将函数`f`和函数`f_cont`手工合并，并且进行尾递归优化。</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, shared_ptr&lt;ContData&gt; cont)</span> </span>{
F_START:
    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) {
        n = <span class="number">1</span>;
        <span class="keyword">goto</span> CONT_START;
    } <span class="keyword">else</span> {
        cont = <span class="built_in">make_shared</span>&lt;ContData&gt;(ContDataType::Outer, n, cont);
        n--;
        <span class="keyword">goto</span> F_START;
    }

CONT_START:
    <span class="keyword">switch</span> (cont-&gt;type)
    {
    <span class="keyword">case</span> ContDataType::Identity:
        <span class="keyword">return</span> n;
    <span class="keyword">case</span> ContDataType::Outer: {
            <span class="type">int</span> nn = n;
            n = cont-&gt;x - <span class="number">2</span>;
            cont = <span class="built_in">make_shared</span>&lt;ContData&gt;(ContDataType::Inner, nn, cont-&gt;p);
            <span class="keyword">goto</span> F_START;
        }
    <span class="keyword">case</span> ContDataType::Inner:
        n = cont-&gt;x + n;
        cont = cont-&gt;p;
        <span class="keyword">goto</span> CONT_START;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>至此，我们完成了C++版本的一般递归调用函数转换为尾递归调用函数的过程。</p>
</div>
</div>
<div class="sect2">
<h3 id="_c语言实现">C语言实现</h3>
<div class="paragraph">
<p>C语言甚至还要更困难一些，因为C语言没有`shared_ptr`这样的东西，也没有带有构造函数的`struct`。不过这都不是什么大问题了，下面给出一个C语言的实现。</p>
</div>
<div class="listingblock">
<div class="content">
<pre><code class="highlight cpp"><span class="keyword">enum</span> { Identity, Outer, Inner };

<span class="keyword">struct</span> <span class="title class_">ContData</span> {
    <span class="type">int</span> type;
    <span class="type">int</span> x;
    <span class="type">int</span> pIdx;
};

<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> STACK_SIZE = <span class="number">10000</span>;

<span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, ContData stack[], <span class="type">int</span> stackTop)</span> </span>{
F_START:
    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) {
        n = <span class="number">1</span>;
        <span class="keyword">goto</span> CONT_START;
    } <span class="keyword">else</span> {
        stackTop++;
        stack[stackTop].type = Outer;
        stack[stackTop].x = n;
        stack[stackTop].pIdx = stackTop - <span class="number">1</span>;
        n--;
        <span class="keyword">goto</span> F_START;
    }

CONT_START:
    <span class="keyword">switch</span> (stack[stackTop].type)
    {
    <span class="keyword">case</span> Identity:
        <span class="keyword">return</span> n;
    <span class="keyword">case</span> Outer: {
            <span class="type">int</span> nn = n;
            n = stack[stackTop].x - <span class="number">2</span>;
            stackTop++;
            stack[stackTop].type = Inner;
            stack[stackTop].x = nn;
            stack[stackTop].pIdx = stack[stackTop - <span class="number">1</span>].pIdx;
            <span class="keyword">goto</span> F_START;
        }
    <span class="keyword">case</span> Inner:
        n = stack[stackTop].x + n;
        stackTop = stack[stackTop].pIdx;
        <span class="keyword">goto</span> CONT_START;
    }
}

<span class="function"><span class="type">int</span> <span class="title">fib</span><span class="params">(<span class="type">int</span> n)</span> </span>{
    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) {
        <span class="keyword">return</span> <span class="number">0</span>;
    } <span class="keyword">else</span> {
        ContData stack[STACK_SIZE];
        stack[<span class="number">0</span>].type = Identity;
        <span class="keyword">return</span> <span class="built_in">f</span>(n, stack, <span class="number">0</span>);
    }
}</code></pre>
</div>
</div>
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="tail-recursion-optimization"></a>[tail-recursion-optimization]: Tail call elimination allows procedure calls in tail position to be implemented as efficiently as goto statements, thus allowing efficient structured programming. In the words of Guy L. Steele "in general procedure calls may be usefully thought of as GOTO statements which also pass parameters, and can be uniformly coded as [machine code] JUMP instructions". <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Tail_call#History">See wikipedia</a>.</p>
</li>
<li>
<p><a id="lambda"></a>[lambda]: F#使用`fun`关键字来创建一个匿名函数。 <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/dd233201.aspx">See MSDN</a>.</p>
</li>
<li>
<p><a id="CXX11-lambda"></a>[CXX11-lambda]: <a target="_blank" rel="noopener" href="http://www.stroustrup.com/C++11FAQ.html#lambda">See C++11 FAQ</a>.</p>
</li>
<li>
<p><a id="latest-vs"></a>[latest-vs]: Visual Studio 2012 update 3. CL版本17.00.60610.1.</p>
</li>
<li>
<p><a id="latest-gxx"></a>[latest-gxx]: g++ 4:4.7.2-1 in Debian jessie.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Shuai Zhang
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://hcoona.github.io/Functional-Programming/tail-recursion-cps-and-recursion-to-loop/" title="尾递归、CPS和将递归转化为循环的一般方法">https://hcoona.github.io/Functional-Programming/tail-recursion-cps-and-recursion-to-loop/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Functional-Programming/" rel="tag"># Functional Programming</a>
              <a href="/tags/Algorithms/" rel="tag"># Algorithms</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/ACM/solution-to-poj-1009/" rel="prev" title="Solution to POJ 1009">
                  <i class="fa fa-angle-left"></i> Solution to POJ 1009
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Tips/export-pdf-using-ghostscript/" rel="next" title="使用 GhostScript 将 PDF 中的指定页面导出为清晰的 PNG 文件">
                  使用 GhostScript 将 PDF 中的指定页面导出为清晰的 PNG 文件 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    © 2011 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Shuai Zhang</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>



</body></html>